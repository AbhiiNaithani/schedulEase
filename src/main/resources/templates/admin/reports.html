<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Reports - schedulEase</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
	<link th:href="@{/css/style.css}" rel="stylesheet">
</head>

<body>
	<div th:replace="~{fragments/header :: header}"></div>
	<div th:replace="~{fragments/navbar-admin :: navbar}"></div>

	<main class="container mt-4">
		<!-- Page Header -->
		<div class="row mb-4">
			<div class="col-md-12">
				<h2><i class="bi bi-file-earmark-text"></i> Reports</h2>
				<p class="text-muted">Generate custom reports for analysis</p>
			</div>
		</div>

		<!-- Flash Messages -->
		<div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
			<i class="bi bi-check-circle"></i> <span th:text="${successMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>
		<div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
			<i class="bi bi-exclamation-triangle"></i> <span th:text="${errorMessage}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<!-- Report Generation Form -->
		<div class="row mb-4">
			<div class="col-md-8">
				<div class="card">
					<div class="card-header bg-primary text-white">
						<h5 class="mb-0"><i class="bi bi-plus-circle"></i> Generate New Report</h5>
					</div>
					<div class="card-body">
						<form th:action="@{/admin/reports/generate}" method="post">
							<div class="mb-3">
								<label for="reportType" class="form-label">Report Type *</label>
								<select class="form-select" id="reportType" name="reportType" required>
									<option value="">-- Select Report Type --</option>
									<option value="bookings">Booking Report</option>
									<option value="users">User Statistics</option>
									<option value="revenue">Revenue Report (Coming Soon)</option>
									<option value="utilization">Room Utilization (Coming Soon)</option>
								</select>
							</div>
							<div class="row">
								<div class="col-md-6">
									<div class="mb-3">
										<label for="startDate" class="form-label">Start Date *</label>
										<input type="date" class="form-control" id="startDate" name="startDate"
											required>
									</div>
								</div>
								<div class="col-md-6">
									<div class="mb-3">
										<label for="endDate" class="form-label">End Date *</label>
										<input type="date" class="form-control" id="endDate" name="endDate" required>
									</div>
								</div>
							</div>
							<button type="submit" class="btn btn-primary">
								<i class="bi bi-file-earmark-arrow-down"></i> Generate Report
							</button>
						</form>
					</div>
				</div>
			</div>

			<!-- Quick Reports -->
			<div class="col-md-4">
				<div class="card">
					<div class="card-header bg-success text-white">
						<h5 class="mb-0"><i class="bi bi-lightning"></i> Quick Reports</h5>
					</div>
					<div class="card-body">
						<div class="d-grid gap-2">
							<button class="btn btn-outline-primary" onclick="generateTodayReport()">
								<i class="bi bi-calendar-day"></i> Today's Bookings
							</button>
							<button class="btn btn-outline-success" onclick="generateWeekReport()">
								<i class="bi bi-calendar-week"></i> This Week
							</button>
							<button class="btn btn-outline-info"
								onclick="setMonthRange(); document.querySelector('form').submit();">This Month
							</button>
							<button class="btn btn-outline-warning"
								onclick="setYearRange(); document.querySelector('form').submit();">This Year
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Report Result -->
		<div th:if="${reportGenerated}" class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header bg-info text-white">
						<h5 class="mb-0">
							<i class="bi bi-file-earmark-check"></i> Generated Report
							<span class="badge bg-light text-dark" th:text="${reportType}">Type</span>
						</h5>
					</div>
					<div class="card-body">
						<p><strong>Date Range:</strong>
							<span th:text="${startDate}">Start</span> to
							<span th:text="${endDate}">End</span>
						</p>
						<hr>
						<div class="alert alert-success">
							<h5>Report Summary</h5>
							<p th:text="${reportData}">Report data will appear here</p>
						</div>
						<!-- Add the bookings table here -->
						<div th:if="${bookingsInRange != null and #lists.size(bookingsInRange) > 0}">
							<hr>
							<h5>Booking Details</h5>
							<div class="table-responsive">
								<table class="table table-bordered table-striped mt-3">
									<thead>
										<tr>
											<th>ID</th>
											<th>User</th>
											<th>Status</th>
											<th>Start Date/Time</th>
											<th>End Date/Time</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="booking : ${bookingsInRange}">
											<td th:text="${booking.id}">1</td>
											<td th:text="${booking.user != null ? booking.user.fullName : 'N/A'}">User
												Name</td>
											<td th:text="${booking.status}">Confirmed</td>
											<td
												th:text="${#temporals.format(booking.startDatetime, 'yyyy-MM-dd HH:mm')}">
												2025-10-01 10:00</td>
											<td th:text="${#temporals.format(booking.endDatetime, 'yyyy-MM-dd HH:mm')}">
												2025-10-01 11:00</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div th:if="${bookingsInRange == null or #lists.isEmpty(bookingsInRange)}">
							<p>No bookings found for this period.</p>
						</div>
						<!-- End bookings table -->
						<button class="btn btn-primary" onclick="window.print()">
							<i class="bi bi-printer"></i> Print Report
						</button>
						<a class="btn btn-success"
							th:href="@{'/admin/reports/export/excel?startDate=' + ${startDate} + '&endDate=' + ${endDate}}">
							<i class="bi bi-file-earmark-excel"></i> Export to Excel
						</a>
					</div>
				</div>
			</div>
		</div>


		<!-- Report History (Placeholder) -->
		<div th:if="${!reportGenerated}" class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<h5 class="mb-0"><i class="bi bi-clock-history"></i> Recent Reports</h5>
					</div>
					<div class="card-body text-center py-5">
						<i class="bi bi-file-earmark text-muted" style="font-size: 4rem;"></i>
						<p class="text-muted mt-3">No reports generated yet</p>
						<p class="text-muted">Generate your first report using the form above</p>
					</div>
				</div>
			</div>
		</div>
	</main>

	<div th:replace="~{fragments/footer :: footer}"></div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script th:src="@{/js/main.js}"></script>
	<script>
		// Quick report helper functions
		function setDateRange(days) {
			const endDate = new Date();
			const startDate = new Date();
			startDate.setDate(startDate.getDate() - days);

			document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
			document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
			document.getElementById('reportType').value = 'bookings';
		}

		function generateTodayReport() {
			setDateRange(0);
			document.querySelector('form').submit();
		}

		function generateWeekReport() {
			setDateRange(7);
			document.querySelector('form').submit();
		}

		function generateMonthReport() {
			setDateRange(30);
			document.querySelector('form').submit();
		}

		function generateYearReport() {
			setDateRange(365);
			document.querySelector('form').submit();
		}
	</script>
</body>

</html>